# 京东购物自动化任务规则
任务完成标准： 确保已经成功下单，且订单信息已记录在user_history.md文件中。

## 任务拆解为以下具体的步骤：

1. 打开京东网站
   - 使用Playwright导航到京东首页，设置超时时间为15000ms（避免网络慢导致的超时问题）
   - 实现重试机制，如果首次加载失败，尝试重新加载2-3次
   - 确认页面加载完成，通过检查关键元素（如logo、搜索框）是否可见
   - 如遇到验证码或反爬虫措施，记录并提示用户手动操作

2. 确保已经登陆，如果没有登陆提示用户扫码登陆

3. 搜索指定商品
   - 定位搜索框并输入商品名称，使用多种选择器策略（ID、class、XPath等）
   - 点击搜索按钮，确保点击事件被正确触发
   - 等待搜索结果加载完成，设置合理的等待时间（至少10秒）
   - 验证搜索结果是否包含相关商品，如无结果则尝试调整搜索关键词

4. 提供多种选择
   - 分析搜索结果页面的商品列表，使用结构化数据提取方法
   - 根据用户订单历史和偏好进行推荐，优先考虑用户之前购买过的品牌
   - 展示至少3-5款不同品牌、价格区间的商品选择，确保多样性
   - 提供每款商品的关键信息（品牌、价格、特点、评分、销量、优惠信息等）
   - 对商品进行分类（如按价格、功能、品牌等），便于用户选择

5. 等待用户指令
   - 接收用户的选择（可以是序号、品牌名或具体描述）
   - 确认用户选择的商品，提供选择确认信息
   - 如用户输入不明确，提供澄清选项
   - 支持用户修改选择或查看更多商品

6. 商品详情页操作
   - 打开用户选择的商品详情页，处理可能的页面跳转或弹窗
   - 分析商品详情、价格、促销信息，确保信息完整性
   - 选择商品规格（如有），默认选择热门或推荐规格
   - 选择购买数量（默认为1），验证库存是否充足
   - 记录商品详细信息，为后续记录做准备

7. 立即购买流程
   - 点击"立即购买"按钮（优先）或"加入购物车"按钮，确保按钮可点击
   - 处理可能出现的登录请求，提供明确的登录状态提示
   - 处理可能出现的403错误或其他异常情况，实现错误恢复机制
   - 设置合理的等待时间，确保页面跳转完成
   - 验证购买流程是否正常进行，如有异常则记录详细错误信息

8. 结算与下单
   - 在结算页面确认订单信息，验证商品信息是否正确
   - 应用可用的优惠券，优先选择最优惠的方案
   - 选择配送方式和支付方式，默认选择标准配送和在线支付
   - 点击"提交订单"按钮，确保按钮可点击
   - 确认订单提交成功并获取订单号，设置足够的等待时间
   - 捕获并记录订单确认页面的所有关键信息

9. 记录购买信息
   - 记录订单号、商品信息、价格、预计送达时间等完整信息
   - 更新user_history.md文件，使用统一的格式记录
   - 提交更改到Git仓库并推送到GitHub，确保提交成功
   - 在记录中包含时间戳和操作状态（成功/失败/模拟）

## 异常处理规则

1. 网络超时问题
   - 对所有网络请求设置合理的超时时间（建议15000-30000ms）
   - 实现重试机制，网络操作失败后自动重试2-3次
   - 记录网络状态和响应时间，便于分析问题
   - 如多次重试仍失败，提供详细的错误报告并建议解决方案

2. 登录问题
   - 如遇需要登录的情况，提供详细的登录状态提示
   - 在模拟环境中，可视为流程已完成，但明确标记为"模拟完成"
   - 记录登录页面的URL和特征，便于后续分析
   - 提供手动登录的指导建议

3. 403错误处理
   - 遇到403 Forbidden错误时，记录完整的请求信息和响应头
   - 尝试更改User-Agent或其他请求头后重试
   - 在模拟环境中，可视为订单已提交，但明确标记为"模拟提交"
   - 记录发生403错误的具体步骤和页面URL

4. 商品无货或不可购买
   - 提供替代商品建议，基于相似度和用户偏好
   - 询问用户是否选择其他商品，提供至少3个替代选项
   - 记录无货商品的详细信息，便于后续分析
   - 实现自动切换到类似商品的功能

5. 页面结构变化处理
   - 使用多种定位策略，增强脚本对页面变化的适应性
   - 定期更新选择器和页面结构信息
   - 实现页面结构自动分析和适应机制
   - 记录页面结构变化，便于维护和更新脚本

6. 验证码和反爬虫措施
   - 检测验证码和反爬虫页面的特征
   - 提供明确的提示，建议用户手动操作
   - 记录触发反爬虫措施的操作序列，以便优化脚本
   - 实现简单验证码的自动识别（如可行）
